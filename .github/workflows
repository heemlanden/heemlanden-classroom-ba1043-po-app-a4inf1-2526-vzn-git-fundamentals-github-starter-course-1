name: Bootstrap backlog

on:
  push:
    branches:
      - main
      - master
  workflow_dispatch:

permissions:
  contents: read
  issues: write

jobs:
  create-labels-and-issues:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # 1) Labels aanmaken/bijwerken op basis van labels.yml
      - name: Create or update labels
        uses: peter-evans/create-or-update-labels@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          labels-json: ${{ toJson(fromYaml(hashFiles('.github/labels.yml') != '' && (format('') || fromYaml(join(github.workspace, '/.github/labels.yml'))) )) }}
        # Fallback als toJson/fromYaml je setup niet ondersteunt:
        # with:
        #   token: ${{ secrets.GITHUB_TOKEN }}
        #   configuration-path: .github/labels.yml

      # 2) User stories + ceremonies als issues met acceptatiecriteria
      - name: Create issue - Setup project structurally
        uses: peter-evans/create-issue@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          title: "Project setup & README"
          body: |
            **Doel**
            Repo voorbereiden op ontwikkeling.

            **Acceptatiecriteria**
            - [ ] README bevat projectdoel, teamleden en takenverdeling
            - [ ] Mapstructuur aangemaakt (src/, docs/, tests/)
            - [ ] `.gitignore` aanwezig en werkt
            - [ ] Issue board-view geactiveerd (Issues → Views → Board)
          labels: |
            User Story
            To Do
            Sprint 1

      - name: Create issue - Login functionaliteit
        uses: peter-evans/create-issue@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          title: "User Story: Inloggen"
          body: |
            **Als** gebruiker  
            **wil ik** kunnen inloggen met e-mail en wachtwoord  
            **zodat ik** toegang krijg tot mijn persoonlijke omgeving.

            **Acceptatiecriteria**
            - [ ] Inlogformulier met validatie
            - [ ] Foutmelding bij ongeldige invoer
            - [ ] Succesvolle login redirect naar `/dashboard`
            - [ ] Tests aanwezig (min. 1 unit- of integratietest)
          labels: |
            User Story
            To Do
            Sprint 1

      - name: Create issue - Productoverzicht
        uses: peter-evans/create-issue@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          title: "User Story: Productoverzicht"
          body: |
            **Als** bezoeker  
            **wil ik** een lijst met producten kunnen zien en filteren op maat  
            **zodat ik** snel vind wat ik zoek.

            **Acceptatiecriteria**
            - [ ] Lijst met productnaam, prijs, afbeelding
            - [ ] Filter op maat (bijv. 42, 42.5, 43)
            - [ ] “Add to cart”-actie zichtbaar
            - [ ] Basisstyling aanwezig
          labels: |
            User Story
            To Do
            Sprint 1

      - name: Create issue - Winkelwagen
        uses: peter-evans/create-issue@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          title: "User Story: Winkelwagen"
          body: |
            **Als** gebruiker  
            **wil ik** producten aan een winkelwagen kunnen toevoegen/verwijderen  
            **zodat ik** mijn bestelling kan samenstellen.

            **Acceptatiecriteria**
            - [ ] Toevoegen/verwijderen werkt zonder pagina-refresh
            - [ ] Subtotaal wordt bijgewerkt
            - [ ] Lege-winkelwagenmelding zichtbaar
          labels: |
            User Story
            To Do

      - name: Create issue - Sprint ceremonies
        uses: peter-evans/create-issue@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          title: "Sprint ceremonies (Planning, Review, Retro)"
          body: |
            **Doel**
            Sprint-rituelen uitvoeren en documenteren in `/docs/sprint-1.md`.

            **Acceptatiecriteria**
            - [ ] Planning: doel + geselecteerde issues vastgelegd
            - [ ] Review: demo-notes + screenshot(s)
            - [ ] Retrospective: 2x went well, 2x to improve, 1x actiepunt
          labels: |
            To Do
            Sprint 1
